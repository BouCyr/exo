<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplication Table</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <link rel="apple-touch-icon" href="icon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #000;
            color: #fff;
            position: relative;
        }
        #score-container {
            position: absolute;
            top: 2rem;
            font-size: 1.5rem;
            font-family: 'Roboto Mono', monospace;
            display: none;
            text-align: center;
            color: #fff;
            transition: color 0.5s ease, text-shadow 0.5s ease;
            text-shadow: 
                0 0 5px #fff,
                0 0 10px #fff,
                0 0 20px #00ffff,
                0 0 30px #00ffff,
                0 0 40px #00ffff,
                0 0 55px #00ffff,
                0 0 75px #00ffff;
        }
        /* Neon Colors */
        .neon-blue {
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #00ffff, 0 0 30px #00ffff, 0 0 40px #00ffff, 0 0 55px #00ffff, 0 0 75px #00ffff !important;
        }
        .neon-pink {
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #ff00ff, 0 0 30px #ff00ff, 0 0 40px #ff00ff, 0 0 55px #ff00ff, 0 0 75px #ff00ff !important;
        }
        .neon-yellow {
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #ffff00, 0 0 30px #ffff00, 0 0 40px #ffff00, 0 0 55px #ffff00, 0 0 75px #ffff00 !important;
        }
        .neon-green {
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #39ff14, 0 0 30px #39ff14, 0 0 40px #39ff14, 0 0 55px #39ff14, 0 0 75px #39ff14 !important;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90%;
            max-width: 400px;
            overflow: hidden;
        }
        #history {
            display: flex;
            flex-direction: column;
            width: 100%;
            gap: 1rem;
        }
        .line {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            gap: 1rem;
            font-family: 'Roboto Mono', monospace;
        }
        .line.fade-out {
            display: none;
        }
        .question {
            margin-bottom: 0;
            white-space: pre;
        }
        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        input {
            font-family: 'Roboto Mono', monospace;
            font-size: 2.5rem;
            width: 5.5rem;
            padding: 0.2rem;
            text-align: center;
            border: 2px solid #444;
            background: #222;
            color: #fff;
            border-radius: 0.5rem;
            box-sizing: border-box;
            -moz-appearance: textfield;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input:focus {
            outline: none;
            border-color: #4a90e2;
        }
        input:read-only {
            border-color: transparent;
            background: transparent;
            color: #39ff14;
            font-weight: bold;
            text-shadow: 0 0 5px #39ff14;
        }
        .checkmark {
            color: #39ff14;
            font-size: 2rem;
            opacity: 0;
            margin-left: 0.5rem;
            font-family: 'Roboto Mono', monospace;
            text-shadow: 0 0 5px #39ff14;
        }
        input:read-only + .checkmark {
            opacity: 1;
        }
        .message {
            height: 2rem;
            font-weight: bold;
            margin-top: 1rem;
            font-family: 'Roboto Mono', monospace;
            font-size: 1.2rem;
        }
        .success {
            color: #39ff14;
            text-shadow: 0 0 5px #39ff14;
        }
        .error {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div id="score-container"></div>
    <div class="container">
        <div id="history"></div>
        <div class="message" id="message"></div>
    </div>

    <script>
        const TABLE_LIMIT = 5;
        const historyContainer = document.getElementById('history');
        const messageElement = document.getElementById('message');
        const scoreContainer = document.getElementById('score-container');

        const scoreMessages = [
            "Super ! {n} victoires !",
            "Bravo ! Déjà {n} points !",
            "Championne ! {n} réussis !",
            "Génial ! Score : {n} !",
            "Top ! Tu en as {n} !",
            "Incroyable ! {n} d'affilée !",
            "Extra ! {n} bonnes réponses !",
            "Magnifique ! {n} dans la poche !",
            "Trop forte ! Déjà {n} !",
            "Waouh ! {n} et ça continue !"
        ];

        const neonClasses = ['neon-blue', 'neon-pink', 'neon-yellow', 'neon-green'];

        let currentResult = 0;
        let activeInput = null;
        let score = 0;

        function updateScore() {
            score++;
            const msgTemplate = scoreMessages[(score - 1) % scoreMessages.length];
            scoreContainer.textContent = msgTemplate.replace('{n}', score);
            
            // Cycle neon colors
            scoreContainer.className = neonClasses[(score - 1) % neonClasses.length];

            if (score > 0) {
                scoreContainer.style.display = 'block';
            }
        }

        function generateQuestion() {
            // Keep only last 3 lines if we are about to add a 4th
            const lines = historyContainer.querySelectorAll('.line');
            if (lines.length >= 4) {
                lines[0].remove();
            }

            const a = Math.floor(Math.random() * TABLE_LIMIT) + 1;
            const b = Math.floor(Math.random() * 10) + 1;
            currentResult = a * b;

            const aStr = a.toString().padStart(2, ' ');
            const bStr = b.toString().padStart(2, ' ');

            const lineDiv = document.createElement('div');
            lineDiv.className = 'line';
            
            const qDiv = document.createElement('div');
            qDiv.className = 'question';
            qDiv.textContent = `${aStr} x ${bStr} =`;
            
            const wrapper = document.createElement('div');
            wrapper.className = 'input-wrapper';

            const input = document.createElement('input');
            input.type = 'number';
            input.placeholder = '?';
            input.autofocus = true;

            const check = document.createElement('span');
            check.className = 'checkmark';
            check.textContent = '✓';

            wrapper.appendChild(input);
            wrapper.appendChild(check);

            lineDiv.appendChild(qDiv);
            lineDiv.appendChild(wrapper);
            historyContainer.appendChild(lineDiv);

            input.focus();
            activeInput = input;

            input.addEventListener('input', () => {
                const val = parseInt(input.value);
                if (val === currentResult) {
                    messageElement.textContent = 'Bravo !';
                    messageElement.className = 'message success';
                    input.readOnly = true;
                    updateScore();
                    setTimeout(() => {
                        messageElement.textContent = '';
                        generateQuestion();
                    }, 400);
                }
            });
        }

        // Initial question
        generateQuestion();

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered!', reg))
                    .catch(err => console.log('SW registration failed: ', err));
            });
        }
    </script>
</body>
</html>